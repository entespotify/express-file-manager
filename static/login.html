<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
</head>

<body>
    <div>
        <input id="email" type="text" name="email" placeholder="email">
        <input id="password" type="password" name="password" placeholder="password">
        <button id="login" type="submit">Login</button>
    </div>
    <script type="text/javascript">
        window.addEventListener("DOMContentLoaded", () => {
            console.log("DOM fully loaded and parsed");
            const submit = document.getElementById('login');
            submit.addEventListener('click', async () => {
                try {
                    const email = document.getElementById('email').value;
                    const password = document.getElementById('password').value;
                    console.log("clicked", email, password);
                    if (email && password) {
                        let res = await fetch('/admin/login', {
                            method: 'POST',
                            headers: { 'Content-Type': "application/json" },
                            body: JSON.stringify({
                                "email": email,
                                "password": password
                            })
                        });
                        if (res.ok) {
                            let data = await res.json();
                            console.log("success:", data);
                            let query = window.location.search;
                            if(query) {
                                let params = new URLSearchParams(query);
                                let origin = params.get("origin");
                                if(origin) {
                                    window.location.replace(origin);
                                }
                                else {
                                    window.location.replace('/');
                                }
                            }
                        } else {
                            console.log("failed:", res.status, res.statusText);
                        }
                    }
                } catch (error) {
                    console.log("error occurred:", error);
                }
            });
        });
    </script>
</body>

</html>